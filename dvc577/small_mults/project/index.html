
<!DOCTYPE html>
<html lang="en">
  <head>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600|Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
    
    <title>Small Multiples - Family spending</title>

    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <link rel="stylesheet" href="../lib/globalStyle.css" /> 
    
	<link rel="stylesheet" href="../lib/styles.css" media="screen">
    <link rel="stylesheet" href="../lib/jquery-ui-1.10.4.custom.min.css">
    <link rel="stylesheet" href="../lib/jquery.ui.labeledslider.css">
<!--    <link rel="stylesheet" href="../lib/style-chosen.css">
    <link rel="stylesheet" href="../lib/owl.carousel.css">
    <link rel="stylesheet" href="../lib/owl.theme.default.css">-->
    
    <style type="text/css">
		body{
			max-width:950px;
			margin:0px auto;
			padding-bottom: 60px;
		}
		
		@media (min-width: 1000px) {
			
			#yearLabel{
				
				font-size:7.5em;
				color:red;
				vertical-align:middle;
				text-align:center;				
			}
			
		} /* end @media (min-width: 1000px) */
		
		
		@media screen and (min-width: 768px) {
			
			#yearLabel{
				
				font-size:7.5em;
				color:blue;
				vertical-align:middle;
				text-align:center;				
			}
			
		} /* end @media screen and (min-width: 768px) */
		
		
		@media (min-width: 700px) {
			
			#yearLabel{
				
				font-size:7.5em;
				color:green;
				vertical-align:middle;
				text-align:center;				
			}
			
		} /* end @media (min-width: 700px) */
		
		
		
		
		@media (max-width: 400px) {
			
			#yearLabel{
				
				font-size:7.5em;
				color:black;
				vertical-align:middle;
				text-align:center;				
			}
			
		} /* end @media (min-width: 400px) */
		
		
		@media (min-width: 401px) {
			
			#yearLabel{
				
				font-size:3.5em;
				color:#666;
				vertical-align:middle;
				text-align:center;				
			}
			
			
			.text{
				
				font-size:0.8em;
				color:green;
				vertical-align:middle;
				text-align:center;				
			}
			
		} /* end @media (min-width: 401px) */
		
		
		@media (min-width: 768px) {
			
			#yearLabel{
				
				font-size:4.0em;
				color:#666;
				vertical-align:middle;
				text-align:center;				
			}
			
			
			.text{
				
				font-size:0.8em;
				color:red;
				vertical-align:middle;
				text-align:center;				
			}
			
		} /* end @media (min-width: 768px) */
		
	.text{		
	font-size:0.8em;	
	}
	
    	.line { stroke:black;
		opacity:0.2; }
		
		#group0 .line-0{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group1 .line-1{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group2 .line-2{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group3 .line-3{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		
		#group4 .line-4{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group5 .line-5{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group6 .line-6{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group7 .line-7{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group8 .line-8{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group9 .line-9{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group10 .line-10{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group11 .line-11{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		#group12 .line-12{
			stroke:#0A449C;
			stroke-width:3px;
			opacity:1;
		}
		
		
		 .circle {
			fill:#F90;
			stroke:#F90;
		}
		
		.svgRect{
			fill: white;	
			fill-opacity:0.0;
		}
		
		.yearLines {
			stroke:#666;
			stroke-width:2px;
			display:none;
			stroke-dasharray:10 5;
		}
		
		
/*
		
		.text{
			color:#666;	
			font-size:16px;
			font-weight:bold;
		}*/
		
		.area {
		    fill: lightsteelblue;
		    stroke-width: 2px;
		}
		
		.area.above {
			fill: #E89B9B;
		}
		
		.area.below {
			fill: blue;
		}
		
		.bars{
			stroke:none;	
			fill:#274796;
			fill-opacity:0.5;
		}
		
			
		.circle:hover,
		.bars:hover
		{	
			cursor:pointer;	
		}
		
		#ChartFooterDiv, .footer {
			font-weight:600!important;
			font-size:14px!important;
			line-height:24px!important;
			margin: opx 0!important;
			padding: 5px 0 3px 0!important;
			font-family: Helvetica,sans-serif!important;
			color: #414042!important;
			box-sizing: border-box!important;
			margin-top:8px;
		}
		
		.submitbut {
			background-color:#0F8243;
			display:block;
			width:200px;
			text-align:center;
			font-size:14px;
			color:white;
			font-weight:100;
			text-decoration:underline;
			width:70px;
			height:43px;
			padding-top:12px;
			margin-right:6px;
			float:left;
		}
		.submitbut:hover {
			cursor:hand;
			cursor:pointer;
			display:block;
			background-color:rgb(11,93,48)!important;
			width:200px;
			text-align:center;
			font-size:14px;
			color:white;
			font-weight:100;
			text-decoration:underline;
			width:70px;
			height:43px;
			padding-top:12px;
			margin-right:6px;
			float:left;
		}
		
		/*
		#yearLabel{
			color:#666;	
			font-size:56px;
			font-weight:bolder;
		}*/
    
    </style>
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
      <script src="../bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->
    <script>


		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-37894017-1']);
		  _gaq.push(['_trackPageview']);
		
		
		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

    </script>
	</head>

	<body>
        
        <div class="container-fluid">
               
            <div class="row">
                <div class="col-sm-12 col-xs-12" id="header">
                </div> 
            </div>
        
            <div class="row">
                <div class="col-sm-12 col-xs-12" id="graphic">
               		<img src="fallback.png" alt="[Chart]" />
                </div> 
            </div>
                
            <div class="row">
                <div class="col-sm-12 col-xs-12" id="keypoints">
                	<p></p>
                </div> 
            </div>
            
            <div class="row">  
                <div class="col-sm-12 col-xs-12" id="footer">
                	<p></p>
                </div>       
            </div>
            
             <div id="ChartFooterDiv">Download this chart</div>
    
                <a href="fallback.png" target="_blank"><div class="submitbut">Image</div></a>
                <a href="alldata.csv" target="_blank"><div class="submitbut">.csv</div></a>
                <a href="alldata.xls" target="_blank"><div class="submitbut">.xls</div></a>
    
		</div>
        

        <script src="../lib/jquery-1.11.1.min.js"></script>
        <script src="../lib/bootstrap.min.js"></script>
        <script src="../lib/modernizr.custom.56904.js"></script>
        <script src="https://cdn.ons.gov.uk/vendor/d3/3.5.17/d3.min.js"></script>
        <script src="https://cdn.ons.gov.uk/vendor/pym/1.3.2/pym.min.js"></script>
	    <script src="../lib/jquery-ui-1.10.4.custom.min.js"></script>    
<!--    	<script src="../lib/jquery.ui.labeledslider.js"></script>
        <script src="../lib/chosen.jquery.js" type="text/javascript"></script>
        <script src="../lib/queue.js" charset="utf-8"></script>
        <script src="../lib/topojson.js"></script>
		<script src="../lib/ss.js"></script>  --> 
          
      
        
        <script>
            
            var header = $('#header');
            var graphic = $('#graphic');
            var keypoints = $('#keypoints');
            var footer = $("#footer");
            var pymChild = null;
            var height;           
            var dvc = {}; // global object variable to contain all variables prefixed with 'dvc.'	
            var pymChild = null;
            var graphHeight; 
			
		
			/*
				NAME: 			drawGraphic
				DESCRIPTION: 	
				CALLED FROM:	
				CALLS:			
				REQUIRES: 		
				RETURNS: 		
			*/
			function drawGraphic()
			{										
				var threshold_md = 700;
				var threshold_sm = dvc.optional.mobileBreakpoint;
				 
				var innerPadding_values = {
										"sm":[ 20 , 20 , 30 , 30 ],
										"md":[ 30 , 20 , 30 , 30 ],
										"lg":[ 30 , 20 , 35 , 30 ]
										/* top , right , bottom , left */
									}
			
				//set variables for chart dimensions dependent on width of #graphic
				if (graphic.width() < threshold_sm) {
						var margin = {top: dvc.optional.margin_sm[0], right: dvc.optional.margin_sm[1], bottom: dvc.optional.margin_sm[2], left: dvc.optional.margin_sm[3]}; 
						var chart_width = graphic.width()/* - margin.left - margin.right*/;
						height = (Math.ceil((chart_width * dvc.optional.aspectRatio_sm[1]) / dvc.optional.aspectRatio_sm[0]) - margin.top - margin.bottom);
						
						var innerPadding = { top : innerPadding_values.sm[0] ,  right : innerPadding_values.sm[1] ,  bottom : innerPadding_values.sm[2] ,  left : innerPadding_values.sm[3] }
						
						numberRows = parseInt(dvc.essential.numRows_sm_md_lg[0]);
						numberColumns = parseInt(dvc.essential.numColumns_sm_md_lg[0]);
												
				} else if (graphic.width() < threshold_md){
						var margin = {top: dvc.optional.margin_md[0], right: dvc.optional.margin_md[1], bottom: dvc.optional.margin_md[2], left: dvc.optional.margin_md[3]}; 
						var chart_width = graphic.width()/* - margin.left - margin.right*/;
						height = (Math.ceil((chart_width * dvc.optional.aspectRatio_md[1]) / dvc.optional.aspectRatio_md[0]) - margin.top - margin.bottom);
						
						var innerPadding = { top : innerPadding_values.md[0] ,  right : innerPadding_values.md[1] ,  bottom : innerPadding_values.md[2] ,  left : innerPadding_values.md[3] }
						
						numberRows = parseInt(dvc.essential.numRows_sm_md_lg[1]);
						numberColumns = parseInt(dvc.essential.numColumns_sm_md_lg[1]);
												
				} else {
						var margin = {top: dvc.optional.margin_lg[0], right: dvc.optional.margin_lg[1], bottom: dvc.optional.margin_lg[2], left: dvc.optional.margin_lg[3]}
						var chart_width = graphic.width()/* - margin.left - margin.right*/;
						height = (Math.ceil((chart_width * dvc.optional.aspectRatio_lg[1]) / dvc.optional.aspectRatio_lg[0]) - margin.top - margin.bottom);
						
						var innerPadding = { top : innerPadding_values.lg[0] ,  right : innerPadding_values.lg[1] ,  bottom : innerPadding_values.lg[2] ,  left : innerPadding_values.lg[3] }
						
						numberRows = parseInt(dvc.essential.numRows_sm_md_lg[2]);
						numberColumns = parseInt(dvc.essential.numColumns_sm_md_lg[2]);
				}
		
				// clear out existing graphics
				graphic.empty();
				keypoints.empty();
				footer.empty()
										
					
				//create legend
				if(dvc.essential.legendLabels.length > 1){
				var legend = d3.select('#graphic').append('ul')
								.attr('class', 'key')
							.selectAll('g')
								.data(dvc.essential.legendLabels)
							.enter().append('li')
	
						legend.append('b')
							 .attr("class",function(d,i){return "border" + i})
						
						legend.append('label')
							 .html(function(d,i) { return dvc.essential.legendLabels[i]; });						
				}
	
				
				var l = 0;
				// parse data into columns
				var lines = {};
											
		
				dvc.line = d3.svg.line()
					.defined(function(d) { return d.amt != ''; })
					.x(function(d) { return x(d.date); })
					.y(function(d) { return y(d.amt); })
					.interpolate("cardinal");;
					
					
					
				graphic_data = dvc.graphic_data_full;
		
				for ( var x=0; x<dvc.fileReadCount; x++ ) {
					
					lines[x] = {};
					
					for (var column in graphic_data[dvc.essential.graphic_data_url[x]][0]) {
						
						if (column == 'date') continue;
						
						lines[x][column] = /*graphic_data*/graphic_data[dvc.essential.graphic_data_url[x]].map(function(d , i) {
													
							return {
								'date': d.date,
								'amt': d[column]
							};

						});
						
						l++;					
					}
				}
								
			
				if (dvc.essential.yAxisScale == "auto_zero_max"){
					
				   var yDomain = [
									0,
									d3.max(d3.entries(lines), function(c) {
										
										for (var column in c.value ) {
											
											return d3.max(c.value[column], function(v) {
												var n = v.amt;
												return Math.ceil(n);
											});
										}
									})								
								];
				} else if (dvc.essential.yAxisScale == "auto_min_max"){
					
					var yDomain = [
									d3.min(d3.entries(lines), function(c) {
										
										for (var column in c.value ) {
											
											return d3.min(c.value[column], function(v) {
												var n = v.amt;
												return Math.floor(n);
											});
										}
									}),

									d3.max(d3.entries(lines), function(c) {
										
										for (var column in c.value ) {
											
											return d3.max(c.value[column], function(v) {
												var n = v.amt;
												return Math.ceil(n);
											});
										}
									})								
								];
				} else {
					
				   var yDomain = dvc.essential.yAxisScale;
				}
				
				
 
				// calcualte SM graph dimensions, and set up maegins for base SM SVG
				var graph_unitWidth = (chart_width-1) / numberColumns;
				var graph_unitHeight = graph_unitWidth*0.8;
				var graph_unitMargins = { top : 5, right : 5 , bottom : 5 , left : 5 };
				
				
				// initial SM graph count variable (k = SM number being created			
				var k = 0;
				var graphLines = {};
				var currentColoumn;
				
				// for each row ... 				
				for ( var i=1; i<=parseInt(numberRows); i++ ) {	
				
					// for each column ... 				
					for ( var j=1; j<=parseInt(numberColumns); j++ ) {
						
						// if graph panel [to draw] is greater than for which data is provided in data files ... 
						if ( k >= l ) { continue; }
						
						graphLines = {};
						
						// for each input data file...
						for ( y=0; y<dvc.essential.graphic_data_url.length; y++ ) {

							// define and initialise data file column counter .. 
							var l = 0;
							
							// for each 'column in data file'														
							for (var column in lines[y] ) {
								
								// if column counter is equal to graph panel number to draw
								if ( l == k ) {
									
									// initialise inner object to store data asscoaited with a single line (i.e. one column in a single file)
									graphLines[y] = {};
									
									// create lines object
									graphLines[y][column] = lines[y][column].map(function(d , i) {	
									
										currentColoumn = column;
										
										return {
											'date': d.date,
											'amt': d.amt
										};
									});									
								}
							
								l++;		
								
							}// end for. ..
							
						} // end for ...
	
						dvc.numGraphs = k;
													
						// create and append small SVG panel for each individual graph, k
						var svg = d3.select('#graphic')
							.append('svg')
							.attr("class" , "graphUnitSVGs")
							.attr("id" , "svg" + k)
							.attr("x", (i-1)*graph_unitWidth + graph_unitMargins.left )
							.attr("y", (j-1)*graph_unitHeight + graph_unitMargins.top )
							.attr("width", graph_unitWidth )
							.attr("height", graph_unitHeight )
							.append("g")
							.attr("transform", "translate(" + (0) + "," + (0) + ")");							
						
										
													
						// define x-axis 
						x = d3.time.scale().range([0, (graph_unitWidth - innerPadding.left - innerPadding.right)]);
						x.domain(d3.extent(graphic_data[dvc.essential.graphic_data_url[0]], function(d) { return d.date; }));
					
					
						xAxis = d3.svg.axis()
							.scale(x)
							.orient("bottom")
							.tickSize(10,0)
						//	.tickFormat(function(d,i) {
//								//specify date format for x axis depending on #graphic width
//								
//								if (graphic.width() <= threshold_sm) {
//									
//									
//									var fmt = d3.time.format(dvc.optional.xAxisTextFormat_sm_md_lg[0]);
//									str = fmt(d);
//									plus = parseInt(str)+1;
//									
//									if(str=="01"||str=="02"||str=="03"||str=="04"||str=="05"||str=="14"||str=="15"||str=="16"){
//										return i % 1 ? "": '\u2019' + str +"/"+ plus;
//									} else {
//										return i % 1 ? "": '\u2019' + str;
//									}
//								} else if (graphic.width() <= threshold_md){
//									var fmt = d3.time.format(dvc.optional.xAxisTextFormat_sm_md_lg[1]);
//									str = fmt(d);
//									plus = parseInt(str)+1;
//									
//									if(str=="01"||str=="02"||str=="03"||str=="04"||str=="05"||str=="14"||str=="15"||str=="16"){
//										return i % 1 ? "": '\u2019' + str +"/"+ plus;
//									} else {
//										return i % 1 ? "": '\u2019' + str;
//									}
//								} else {
//									var fmt = d3.time.format(dvc.optional.xAxisTextFormat_sm_md_lg[2]);
//									str = fmt(d);
//									plus = parseInt(str)+1
//									if(str=="01"||str=="02"||str=="03"||str=="04"||str=="05"||str=="14"||str=="15"||str=="16"){
//										return i % 1 ? "": '\u2019' + str +"/"+ plus;
//									} else {
//										return i % 1 ? "": '\u2019' + str;
//									}
//								}
//							})
							.tickPadding(5);
						
						//specify number of ticks on x axis and whether 1st and last data point labels are included
						if(graphic.width()<threshold_sm){ xAxis.tickValues(x.ticks(dvc.optional.x_num_ticks_sm_md_lg[0]).concat( x.domain() ));}
						else if (graphic.width() <= threshold_md){ xAxis.tickValues(x.ticks(dvc.optional.x_num_ticks_sm_md_lg[1])); }
						else { xAxis.tickValues(x.ticks(dvc.optional.x_num_ticks_sm_md_lg[2])); }
						
						//create x axis, if y axis doesn't start at 0 drop x axis accordingly	
						svg.append('g')
							.attr('class', 'x axis')
							.attr('id', 'focusXAxis' + k)
							.attr('transform', function(d, i){ 
								if(yDomain[0] != 0) { return "translate(" + (innerPadding.left) + "," + (graph_unitHeight - innerPadding.bottom) + ")" }
								else { return "translate(" + (innerPadding.left) + "," + (graph_unitHeight - innerPadding.bottom) + ")"; }
							})
							.call(xAxis);
						
						
												
						//set up y-axis scsale ... 
						y = d3.scale.linear().domain(yDomain).range([ (graph_unitHeight - innerPadding.top - innerPadding.bottom) , 0 ]);
						yAxis = d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(",.0f"));
						
						
						//specify number or ticks on y axis
						if (graphic.width() <= threshold_sm) { yAxis.ticks(dvc.optional.y_num_ticks_sm_md_lg[0]) }
						else if (graphic.width() <= threshold_md) { yAxis.ticks(dvc.optional.y_num_ticks_sm_md_lg[1]) }
						else { yAxis.ticks(dvc.optional.y_num_ticks_sm_md_lg[2]) }						
						
														
						svg.append("g")
							.attr("class", "y axis")
							.attr("id", "focusYAxis" + k)
							.attr("transform", "translate(" + (innerPadding.left) + "," + (innerPadding.top) + ")")
							.call(yAxis);	
							
														
						// draw tick grid lines extending from y-axis ticks on axis across scatter graph
						yticks = svg.selectAll('#focusYAxis' + k).selectAll('.tick');					 
						yticks.append('svg:line')
							.attr( 'id' , "yAxisTicks" )
							.attr( 'y0' , 0 )
							.attr( 'y1' , 0 )
							.attr( 'x1' , 0 )
							.attr( 'x2', graph_unitWidth - innerPadding.right - innerPadding.left )
							.style("opacity" , 0.5);
													
															
						//create centre line if required
						if (dvc.optional.centre_line == true) {
							
							svg.append("line")
								.attr("id","centreline")
								.attr('y1',y(dvc.optional.centre_line_value) + innerPadding.top)
								.attr('y2',y(dvc.optional.centre_line_value) + innerPadding.top)
								.attr('x1',innerPadding.left)
								.attr('x2',graph_unitWidth-innerPadding.right);
						}
						else if(yDomain[0]<0) {
							
							svg.append("line")
								.attr("id","centreline")
								.attr('y1',y(0) + innerPadding.top)
								.attr('y2',y(0) + innerPadding.top)
								.attr('x1',innerPadding.left)
								.attr('x2',graph_unitWidth - innerPadding.right);
								
						}  // end else if...
						
						
						// only draw y-axis labels if drawing graphs in first COLUMN
						if ( j == 1 ) { 
							
							svg.append("text")
								.attr("class" , "label")
								.attr("id" , "yAxisLabel" + k)
								.attr("x" , innerPadding.left/2)
								.attr("y" , innerPadding.top/2)
								.style("font-size" , "10px" )
								.style("font-weight" , "normal" )
								.style("text-anchor" , "start" )
								.text(dvc.essential.yAxisLabel);
								
						} // end if ... 
						
						
						// only draw x-axis labels if drawing graphs in final ROW
						if ( i == 4 ) {
							
							svg.append("text")
								.attr("class" , "label")
								.attr("id" , "xAxisLabel" + k)
								.attr("x" , graph_unitWidth - innerPadding.right)
								.attr("y" , function (d,i){
									if (graphic.width() < threshold_sm) { return graph_unitHeight - (0); }
									else if (graphic.width() < threshold_md) { return graph_unitHeight - (0); }
									else { return graph_unitHeight - (10); }
								})
								.style("font-size" , "10px" )
								.style("font-weight" , "normal" )
								.style("text-anchor" , "end" )
								.text(dvc.essential.xAxisLabel);
								
						} // end if ... 
						
												
						//create lines 		
						svg.append('g')
							.attr("id", function(d, i) { return 'group' + k; })
							.attr("transform", "translate(" + (innerPadding.left) + "," + (innerPadding.top) + ")")
							.selectAll('path')
							.data(d3.entries(graphLines))
							.enter()
							.append('path')
								.attr('class', function(d, i) { return 'line line-' + i; })
								.attr('id', function(d, i) { return 'smallLine' + k + "-" + i; })
								.attr('d', function(d , i) { return dvc.line(d.value[currentColoumn]); });
									
									
						// draw text in upper right corner of each graph with the associated title from data.csv
						svg.append("text")
							.data(d3.entries(/*lines*/graphLines))
							.attr('class', function(d, i){ return 'text labels'; })
							.attr('id', function(d, i){ return 'label1-' + k/* + i*/; })
							.attr("x" , (graph_unitWidth - margin.right - innerPadding.right +20))
							.attr("y" , 20 )
							.style("display" , "inline")
							.style("pointer-events" , "none")
							.style("text-anchor" , "end")
							.text(function(d,i){ return /*d.key*/currentColoumn; });
							
							
						// call function to write annocation to individual graphs if defined in config
						if ( graphic.width() > threshold_sm ) {
							writeAnnotation(k);
						}// end if ... 
							
						k++;
					}
					
				} // end for ...
				
				
				// call function to write annocation to individual graphs if defined in config
				if ( graphic.width() < threshold_sm ) {
					writeAnnotation(k);
				}// end if ... 
				
								
				function writeAnnotation(k){
				
					if (graphic.width() < threshold_sm) {
						
							dvc.essential.annotationBullet.forEach(function(d,i) {
							
								if ( d != '' ) {
																
									d3.select("#keypoints").append("svg")
									.attr("width","20px")
									.attr("height","20px")
									.attr("class","circles")
									.append("circle")
									.attr("class", "annocirc" + (i))
									.attr("r", "2")
									.attr('cy',"12px")
									.attr("cx", "10px");
								
									d3.select("#keypoints").append("p").text(dvc.essential.annotationBullet[i]);
								
								
									// draw circles, if var 'dvc.essential.circles' is set to true
									if ( dvc.essential.circles == true ) {
										
										svg.append("circle")
											.attr("class", "annocirc" + (i))
											.attr('cy',y(dvc.essential.annotationCXCY[i][1]))
											.attr('cx',x(dvc.essential.annotationCXCY[i][0]))
											.attr("r", "5");
										
									} // end if ... 
									
								} // end if ... 
							
							})// end foreach
					}		
					else {
						
					//		dvc.essential.annotationChart.forEach(function(d,i) {	
							
								// draw annotation text based on content of var annotationArray ...
									
									
								function insertLinebreaks() {
									
									var str = this;
				
									var el1 = dvc.essential.annotationChart[/*i*/k];
									var el = el1.data;
							
									var words = el1.split('  ');
									
									d3.select(this).text('');
								
									for (var j = 0; j < words.length; j++) {
										var tspan = d3.select(this).append('tspan').text(words[j]);
										if (j > 0)
											tspan.attr('x', x(dvc.essential.annotationXY[/*i*/k][0])).attr('dy', '22');													
									}
								};					
														
								function createBackRect() {
										
									var BBox = this.getBBox()
											
									svg.insert("rect", ".annotext" + (/*i*/k))
										.attr("width", BBox.width)
										.attr("height", BBox.height)
										.attr("x", BBox.x)
										.attr("y", BBox.y)
										.attr("fill", "white")
										.attr("opacity", 0.4);
											
								}; // end function createBackRect()
								svg.append("text")
									.text(dvc.essential.annotationChart[/*i*/k])
									.attr("class","annotext" + /*i*/k)
									.attr("text-anchor", dvc.essential.annotationAlign[/*i*/k])
									.attr('y',y(dvc.essential.annotationXY[/*i*/k][1]))
									.attr('x',x((dvc.essential.annotationXY[/*i*/k][0])));
											
								d3.selectAll(".annotext" + (/*i*/k))
									.each(insertLinebreaks)
									.each(createBackRect);	
								
							//});	// end foreach 		
						
					} // end else ... 
					
					return;
					
				}// end function writeAnnotation()					
	
//				

				//create link to source				
				d3.select("#footer").append("p")
					.text("Source: "+ dvc.essential.sourceText);
			
				
				
				d3.selectAll(".graphUnitSVGs").selectAll(".x").selectAll(".tick")
					.selectAll("text")
					.each(function(d,i){
						format = d3.time.format("%Y")
						//console.log(format(d))
						
							if(format(d)=="2001"){
							//	console.log(d3.select(this).text())
								d3.select(this).text("'01/'02")
							} else if(format(d)=="2006"){
								d3.select(this).text("'06")
							} else if(format(d)=="2011"){
								d3.select(this).text("'11")
							} else if(format(d)=="'16"){
								d3.select(this).text("'15/'16 ")
							} else if(format(d)=="2018"){
								d3.select(this).text("'17/'18 ")
							} else {
								d3.select(this).text("")
							}
					})
					
//					d3.selectAll(".graphUnitSVGs").selectAll(".x").selectAll(".tick")
//					.selectAll("line")
//					.each(function(d,i){
//						format = d3.time.format("%Y")
//						console.log(format(d))
//						
//							if(format(d)=="2001"){
//								d3.select(this).style("stroke", "#666")
//							} else if(format(d)=="2005"){
//								d3.select(this).style("stroke", "#666")
//							} else if(format(d)=="2009"){
//								d3.select(this).style("stroke", "#666")
//							} else if(format(d)=="2012"){
//								d3.select(this).style("stroke", "#666")
//							} else if(format(d)=="2016"){
//								d3.select(this).style("stroke", "#666")
//							} 
//					})
							
							
					d3.selectAll(".graphUnitSVGs").selectAll(".x").selectAll(".tick")
					.selectAll("line")
					.attr("y2", function(d){
						format = d3.time.format("%Y")
						
							if(format(d)=="2001"){
								return 8;
							} else if(format(d)=="2006"){
								return 8;
							} else if(format(d)=="2011"){
								return 8;
							} else if(format(d)=="2016"){
								return 8;
							} else {
								return 5;	
							}
						});
					
					
				//use pym to calculate chart dimensions	
				if (pymChild) {
					pymChild.sendHeight();
				}
						
			
				return;
				 
			
			 } // end function drawGraphic()
		 
			 
						
										
			
			//then, onload, check to see if the web browser can handle 'inline svg'
			if (Modernizr)
			{
				
				
				// open and load configuration file. 					
				d3.json("config.json", function(error, json)
				{					
					// strore read in json data from config file as as global dvc. variable ...	
					dvc = json;
					
					dvc.graphic_data_full = {};
					dvc.fileReadCount = 0;
					
					dvc.essential.graphic_data_url.forEach(function(d,i){
						
						var objName = d;	
						graphic_data_url = objName;						
						
						//load chart data
						d3.csv(graphic_data_url, function(error, data) {
							graphic_data_interim = data;
							
							graphic_data_interim.forEach(function(d,i) {
								d.date = d3.time.format(dvc.essential.dateFormat).parse(d.date);
							});
							
							dvc.graphic_data_full[objName] = graphic_data_interim;
														
							dvc.fileReadCount++;
							if ( dvc.fileReadCount == dvc.essential.graphic_data_url.length ) { pymChild = new pym.Child({renderCallback: drawGraphic}); }
						})						
					})
				})		
				
			
			} // end if ... 
			else
			{
					 //use pym to create iframe containing fallback image (which is set as default)
					 pymChild = new pym.Child();
					if (pymChild) {
						pymChild.sendHeight();
					}
			}
		
		
		</script>
        
  </body>
</html>
