<!DOCTYPE html>
<html lang="en">

<head>

  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MBCBVQS');
  </script>
  
  <title>Young peoples mental health data explorer</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800|Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>

  <meta name="description" content="">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="./lib/globalStyle.css" />
  <style type="text/css">


  /* http://meyerweb.com/eric/tools/css/reset/
   v2.0 | 20110126
   License: none (public domain)
*/

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video, button {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
	display: block;
}
body {
	line-height: 1;
}
ol, ul {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}


    .background0 {
      background: #F5942F;
    }

    .background1 {
      background: #7BCAE2;
    }

    #triangleEnd {
      fill: black;
    }

    #triangleStart {
      fill: black;
    }

    .x.axis path {
      display: none;
    }

    .focusCircle {
      fill: red;
    }

    body {
      max-width: 700px;
      font-family: "Open Sans", sans-serif;
    }

    .main_thing {
      align-items: center;

    }

    h1,
    h2,
    h4 {
      color: #124d80;
    }
    h2 {
      font-size: 16px;
      font-weight: bold;
      padding-bottom:10px;
    }

    #filtertext {
      line-height: 1.3;
      padding: 20px 0px 10px 0px;
    }

    .btn {
      position: relative;
      padding: 7px 15px;
      margin: 0;
      line-height: normal;
      color: #124d80;
      font-size: 0.8em !important;
      font-size: 1rem;
      font-weight: 400;
      border-radius: 20px !important;
      display: inline-block;
      text-rendering: optimizeLegibility;
      border:2px solid #124d80;
      background-color: #fff;
      font-size:14px;
      cursor:pointer;
      box-shadow: none;
    }

    .btn:hover {
      color: none;
      background-color: #124d80;
    }

    .btn:active {
      top: 0px;
    }

    .btn:active {
      color: #fff;
      background-color: #124d80;
    }

    .btnselect {
      outline: none;
      color: #fff;
      background-color: #124d80;
      outline-offset: 0px;
    }


    .btn--blue:hover {
      color: #fff !important;
    }

    .btn:focus, .filter_img:focus, .gender_img:focus{
	  box-shadow: 0 0 0pt 3pt orange;
      outline: none;
      border-radius: 20px;

    }

    button,
    [type="button"],
    [type="reset"],
    [type="submit"] {
     -webkit-appearance: none;
    }

    p {
      font-size: 14px;
    }

    .filter_img, .gender_img {
      border: 2px #124d80 solid;
      border-radius: 22px;
      display: inline-block;
      padding: 0px 13px 3px 4px;
      height: 30px;
      margin-right: 5px;
	  margin-bottom: 5px;
    }


    .filter_img text, .gender_img text {
      float: right;
      padding-top: 10px;
      padding-left: 2px;
      color: #124d80;
      font-size:14px;
    }

    h4 {
      margin-top: 20px !important;
      margin-bottom: 10px !important;
      font-weight:600;
    }

    .images_div, .gender_div, .ages_div {
        cursor: pointer;
		margin:3px
    }

    .circlemin {
        fill: #fff;
        cursor: pointer;

    }

    .circlemax {
        fill: #fff;
        cursor: pointer;
    }

    .circlemed {
        fill: #fff;
        cursor: pointer;
    }

    .circleactive {
        fill: #fff;
        stroke: #159191;
    }

    .circleactive2 {
        fill: #159191;
        stroke: #159191;
    }

    .rect, .legend {
      cursor: pointer;
    }

    .tooltip, .tooltip2 {
      position: relative;
      visibility: hidden;
      display: inline-block;
      border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
    }

    /* Tooltip text */
    #tooltip {
             background: #206095;
             color: #fff;
             font-family: 'Open Sans';
             font-weight:400;
             font-size:12px;
             border: 1px solid #206095;
             border-radius: 5px;
             padding: 5px;
             width: 150px;
             text-align:center;
             opacity: 0.9;
           }

   #tooltip2 {
      background: #159191;
      color: #fff;
      font-family: 'Open Sans';
      font-weight:400;
      font-size:12px;
      border: 1px solid #159191;
      border-radius: 5px;
      padding: 5px;
      width: 35px;
      text-align:center;
      opacity: 0.9;
    }


           #tooltip::after {
               content: " ";
               position: absolute;
               bottom: 100%;  /* At the top of the tooltip */
               left: 49%;
               margin-left: 0px;
               border-width: 5px;
               border-style: solid;
               border-color: transparent transparent #206095 transparent;
             }



              #tooltip2::after {
                content: " ";
                position: absolute;
                top: 100%; /* At the bottom of the tooltip */
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: #159191 transparent transparent transparent;
              }


             .tooltipleft::after {

                 left: 26px !important;

             }

             .tooltipright::after {

                 left: 155px !important;

             }
			 
			 #keypoints {
				 color: #323132 !important;
				font-weight: 400;
				margin-top: 20px;
				line-height: 1.3;
			 }
  </style>
</head>

<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBCBVQS"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div>
    <h2>Select an age group</h2>
    <div class="ages_div">
    <button tabindex=1 style="width:32%" id="YMH_2to4" class="btn btn--secondary btn--blue col-sm-3">2-4</button>
    <button tabindex=2 style="width:32%" id="YMH_5to10" class="btn btn--secondary btn--blue col-sm-3">5-10</button>
    <button tabindex=3 style="width:32%" id="YMH_11to16" class="btn btn--secondary btn--blue col-sm-3">11-16</button>
	</div>

    <h2 id="filtertext">Select all children, boys or girls to see how each group varies</h2>
    <div class="gender_div">

    </div>

    <h2 id="filtertext">Click to see how rates of mental disorders in children change for different factors.</h2>
    <div class="images_div">

    </div>


    <!-- <h4 id="filter_title">Average percent of mental health disorders of childred aged </h4> -->
    <div id="graphic">
      <!-- <img src="fallback.png" alt="[Chart]" /> -->
    </div>
    <div class="footer">
    Source: NHS Digital
    </div>
    <div id="tooltip" display="none" style="position: absolute; opacity: 0;"></div>
    <div id="tooltip2" display="none" style="position: absolute; opacity: 0;"></div>

    <div id="keypoints">
      <p>Note: These results are based on the Mental Health of Children and Young People Survey, 2017. They are estimates based on a sample of children in England. If we had surveyed all children in England we may have found different results. For information on how to interpret these results, visit: <a href='https://digital.nhs.uk/pubs/mhcypsurvey17'>https://digital.nhs.uk/pubs/mhcypsurvey17</a></p>
    </div>



    <script src="https://cdn.ons.gov.uk/vendor/d3/4.13.0/d3.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.1.0/d3-annotation.js" type="text/javascript"></script>
    <script src="./lib/modernizr.svg.min.js" type="text/javascript"></script>
    <script src="https://cdn.ons.gov.uk/vendor/pym/1.3.2/pym.min.js" type="text/javascript"></script>
    <script>
      var graphic = d3.select('#graphic');
      var keypoints = d3.select('#keypoints');
      //var footer = d3.select(".footer");
      var pymChild = null;
      var rowheight = 40;
      var curr_age = "YMH_2to4";
      var curr_id = null;
      var gender = "mymedian";
      var x = null;
      var formatval = d3.format(".0f");

      // image details for age groups
      var data_2to4 = [
        {
          src: "img/ethnicity.svg",
          id: "ethnicity",
          class:"filter_img",
          name: "Ethnic group",
          title:"% of children with mental health conditions by ethnic group",
          tooltip:"Ethnic group of child"

        },
        {
          src: "img/famfunc.svg",
          id: "famfunc",
          class:"filter_img",
          name: "Family functioning",
          title:"% of children with mental health conditions by Ethnicity",
          tooltip:"How well the family gets on"

        },
        {
          src: "img/pmental.svg",
          id: "pmental",
          class:"filter_img",
          name:"Parental mental health",
          title:"",
          tooltip:"Parents mental health"

        },
        {
          src: "img/income.svg",
          id: "income",
          class:"filter_img",
          name:"Household income",
          title: "",
          tooltip:"Household income"

        },
        {
          src: "img/benefits.svg",
          id: "benefits",
          class:"filter_img",
          name:"Welfare benefits",
          title:"",
          tooltip:"In reciept of income and disability benefits"

        }
      ]

      var data_5to10 = [{
        src: "img/ethnicity.svg",
        id: "ethnicity",
        class:"filter_img",
        name:"Ethnicity",
        tooltip:"Ethnic group of child"

      },
      {
        src: "img/famfunc.svg",
        id: "famfunc",
        class:"filter_img",
        name:"Family functioning",
        tooltip:"How well the family gets on"

      },
      {
        src: "img/pmental.svg",
        id: "pmental",
        class:"filter_img",
        name:"Parental mental health",
        tooltip:"Parents mental health"

      },
      {
        src: "img/income.svg",
        id: "income",
        class:"filter_img",
        name:"Household income",
        tooltip:"Household income"

      },
      {
        src: "img/benefits.svg",
        id: "benefits",
        class:"filter_img",
        name:"Welfare benefits",
        tooltip:"In reciept of income and disability benefits"

      }]

      var data_11to16 = [{
        src: "img/ethnicity.svg",
        id: "ethnicity",
        class:"filter_img",
        name:"Ethnicity",
        tooltip:"Ethnic group of child"

      },
      {
        src: "img/famfunc.svg",
        id: "famfunc",
        class:"filter_img",
        name:"Family",
        tooltip:"How well the family gets on"

      },
      {
        src: "img/pmental.svg",
        id: "pmental",
        class:"filter_img",
        name:"Parental mental health",
        tooltip:"Parents mental health"

      },
      {
        src: "img/income.svg",
        id: "income",
        class:"filter_img",
        name:"Household income",
        tooltip:"Household income"

      },
      {
        src: "img/benefits.svg",
        id: "benefits",
        class:"filter_img",
        name:"Welfare benefits",
        tooltip:"In reciept of income and disability benefits"

      }
      ]

      var data_17to19 = [{
        src: "img/ethnicity.svg",
        id: "ethnicity",
        class:"filter_img",
        name:"Ethnicity",
        tooltip:"Ethnic group of child"

      },
      {
        src: "img/famfunc.svg",
        id: "famfunc",
        class:"filter_img",
        name:"Family functioning",
        tooltip:"How well the family gets on"

      },
      {
        src: "img/pmental.svg",
        id: "pmental",
        class:"filter_img",
        name:"Parental mental health",
        tooltip:"Parents mental health"

      },
      {
        src: "img/income.svg",
        id: "income",
        class:"filter_img",
        name:"Household income",
        tooltip:"Household income"

      },
      {
        src: "img/benefits.svg",
        id: "benefits",
        class:"filter_img",
        name:"Welfare benefits",
        tooltip:"In reciept of income and disability benefits"

      }
      ]

      drawImages()
      drawGenderImages()

      function drawImages () {

        tabindex = 7;

          agegroup = curr_age.substr(3);

            d3.select(".images_div")
              .selectAll(".filter_img").remove();

            imagepills = d3.select(".images_div")
              .selectAll("div")
              .data(eval("data" + agegroup))
              .enter()
              .append("div")
              .attr("data-nm", function(d){return d.name})
              .attr("tabindex", function(d,i){return tabindex+i})
              .attr("id", function(d) {return d.id})
              .style("display","inline-block")
              .attr("class", "filter_img")
              .on("mouseover", function(d){showTooltip(d,this);})
              .on("mouseout", function(d){hideTooltip(d);})


          imagepills.append("img").attr("src", function(d) {return "img/" + d.id + ".svg"})
              .attr("height", "35px")
              .attr("width", "35px")
              .attr("data-nm", function(d){return d.name})
              //.attr("class", "filter_img")


          imagepills.append("text").text(function(d,i){return d.name})

          d3.select(".images_div")
            .selectAll(".filter_img")
            .on("click", addClick)
            .on("mouseover", function(d){
              d3.select(this)
                .style("border", "2px #124d80 solid")
                .style("background-color", "#124d80")

              d3.select(this).select("img").attr("src", function(d) {return "img/" + d.id + "_sel.svg"})
              d3.select(this).select("text").style("color","#fff");
            })
            .on("mouseout", function(d){
			  if(d3.select(this).classed("active") == false) {
				  d3.select(this)
					.style("border", "2px #124d80 solid")
					.style("background-color", "#fff")
					.style("color","#124d80");
	
				  d3.select(this).select("img").attr("src", function(d) {return "img/" + d.id + ".svg"});
				  d3.select(this).selectAll("text").style("color","#124d80")
			  };
            })
            .on("keypress", function(d) {
              if(d3.event.keyCode === 32 || d3.event.keyCode ===13) {
                addClick(d);
              }
            })

      } //end drawimages

      function drawGenderImages () {

        tabindex = 4


            d3.select(".gender_div")
              .selectAll(".gender_img").remove();

            imagepills = d3.select(".gender_div")
              .selectAll("div")
              .data(["All","Boys","Girls"])
              .enter()
              .append("div")
              .attr("tabindex", function(d,i){return tabindex+i})
              .attr("id", function(d) {return "btn" + d})
              .style("display","inline-block")
              .attr("class", "gender_img");


          imagepills.append("img").attr("src", function(d) {return "img/" + d + ".svg"})
              .attr("height", "35px")
              .attr("width", "35px")
              .attr("id", function(d) {return "btn" + d})
              //.attr("name", function(d){return d.name})
              //.attr("class", "filter_img")


          imagepills.append("text").text(function(d,i){return d})

          d3.select(".gender_div")
            .selectAll(".gender_img")
            .on("mouseover", function(d){
              d3.select(this)
                .style("border", "2px #124d80 solid")
                .style("background-color", "#124d80")

              d3.select(this).select("img").attr("src", function(d) {return "img/" + d + "_sel.svg"})
              d3.select(this).select("text").style("color","#fff");
            })
            .on("mouseout", function(d){
				if(d3.select(this).classed("active") == false) {
				  d3.select(this)
					.style("border", "2px #124d80 solid")
					.style("background-color", "#fff")
					.style("color","#124d80");
	
				  d3.select(this).select("img").attr("src", function(d) {return "img/" + d + ".svg"});
				  d3.select(this).selectAll("text").style("color","#124d80")
				}

            })
            .on("click", addGenderClick)
            .on("keypress", function(d) {
              if(d3.event.keyCode === 32 || d3.event.keyCode ===13) {
                addGenderClick(d);
              }
            })


          d3.select("#btnAll")
            .style("border", "2px #124d80 solid")
            .style("background-color", "#124d80")

          d3.select("#btnAll").select("img").attr("src", function(d) {return "img/" + d + "_sel.svg"})
          d3.select("#btnAll").select("text").style("color","#fff")

      } //end drawGenderImages

      function showTooltip(d,x){

          var rect = x.getBoundingClientRect();

              ox = ((rect.left + rect.right) / 2) - 75
              oy = rect.top



                d3.select("#tooltip")
                      .classed("tooltipleft",false)
                      .classed("tooltipright",false)
                      .style("left", ox + "px")
                      .style("top", (oy + 47) + "px")
                      .text(d.tooltip)
                      .transition()
                      .duration(300)
                      .style("opacity","1");
              //}

            } //end showTooltip

            function hideTooltip(d){

              d3.select("#tooltip")
                .transition()
                .duration(300)
                .style("opacity","0");

            } //end hideTooltip

            function showTooltip2(d,x,vall){


            var rect = x.getBoundingClientRect();

                ox = ((rect.left + rect.right) / 2) - 23.5
                oy = rect.top

                  d3.select("#tooltip2")
                        .classed("tooltipleft",false)
                        .classed("tooltipright",false)
                        .style("left", ox + "px")
                        .style("top", (oy - 30) + "px")
                        .text(formatval(vall) + "%")
                        .transition()
                        .duration(300)
                        .style("opacity","1");
                //}

              } //end showTooltip

              function hideTooltip2(d){

                d3.select("#tooltip2")
                  .transition()
                  .duration(300)
                  .style("opacity","0");

              } //end hideTooltip

      function addClick(d) {

        //d3.select("#filter_title").selectAll("text").remove();
        d3.selectAll(".filter_img")
          .style("border", "2px #124d80 solid")
          .style("background-color", "#fff")
          .style("color","#124d80");

      d3.selectAll(".filter_img").select("img").attr("src", function(d) {return "img/" + d.id + ".svg"});

      d3.selectAll(".filter_img").selectAll("text").style("color","#124d80")

	   d3.selectAll(".filter_img").classed("active",false);

        curr_id = d3.select("#" + d.id).attr('id')

        update_graphic(curr_id);
		
		d3.select("#" + d.id).classed("active",true);

        d3.select("#" + d.id)
          .style("border", "2px #124d80 solid")
          .style("background-color", "#124d80")

        d3.select("#" + d.id).select("img").attr("src", function(d) {return "img/" + d.id + "_sel.svg"})
        d3.select("#" + d.id).select("text").style("color","#fff")

      } //end addClick


      function addGenderClick(d) {

      genderlabel =  "btn" + d;

      if(genderlabel == "btnAll") {
        gender = "mymedian";
      } else if(genderlabel =="btnBoys") {
        gender = "mymax";
      } else if(genderlabel =="btnGirls") {
        gender = "mymin";
      }

	  d3.selectAll(".gender_img").classed("active",false);

      d3.selectAll(".gender_img")
          .style("border", "2px #124d80 solid")
          .style("background-color", "#fff")
          .style("color","#124d80");

      d3.selectAll(".gender_img").select("img").attr("src", function(d) {return "img/" + d + ".svg"});

      d3.selectAll(".gender_img").selectAll("text").style("color","#124d80")


        update_graphic(curr_id);
		
		d3.select("#" + genderlabel).classed("active",true);

        d3.select("#" + genderlabel)
          .style("border", "2px #124d80 solid")
          .style("background-color", "#124d80")

        d3.select("#" + genderlabel).select("img").attr("src", function(d) {return "img/" + d + "_sel.svg"})
        d3.select("#" + genderlabel).select("text").style("color","#fff")
		


      } //end addClick


      function update_graphic(curr_id) {

        graphic_data = graphic_data1.filter(function(d) {
          return d.category == "average" || d.category == curr_id
        })

        height = (rowheight*graphic_data.length) + margin.top + margin.bottom;

        tieFight();
        //createLegend();


      } //update_graphic


      function wrap(text, width) {
        text.each(function() {
          var text = d3.select(this),
              words = text.text().split(/\s+/).reverse(),
              word,
              line = [],
              lineNumber = 0,
              lineHeight = 1.1, // ems
              y = text.attr("y"),
              dy = parseFloat(text.attr("dy")),
              tspan = text.text(null).append("tspan").attr("x", -9).attr("y", y).attr("dy", dy + "em");
          while (word = words.pop()) {
            line.push(word);
            tspan.text(line.join(" "));
            if (tspan.node().getComputedTextLength() > width) {
              line.pop();
              tspan.text(line.join(" "));
              line = [word];
              tspan = text.append("tspan").attr("x", -9).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
            }
          }

          currtextheight = d3.select(this).node().getBBox().height;

          d3.select(this).selectAll("tspan").attr("y",9 -(currtextheight*0.666)/2)//.attr("dy",0 + "em")


        }
      );
      }


      function tieFight() {

        //keypoints.selectAll("*").remove();

        x = d3.scaleLinear()
          .range([0, chart_width]);

        y = d3.scalePoint()
          .padding(0.3)
          .range([0, height]);

        y.domain(graphic_data.map(function(d) {
          return d.subcat;
        }));

        yAxis = d3.axisLeft(y)

        var xAxis = d3.axisBottom(x);

        //specify number or ticks on x axis
        if (parseInt(graphic.style("width")) <= threshold_sm) {
          xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[0])
        } else if (parseInt(graphic.style("width")) <= threshold_md) {
          xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[1])
        } else {
          xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[2])
        }


        lines = graphic_data.map(function(d, i) {
          return {
            'category': d.category,
            'subcat': d.subcat, // might not need since we mapped it in y.domain earlier
            'mymin': +d.girls, // + changes string to numeric.
            'mymax': +d.boys,
            'mymedian': +d.all

          };
        });
        var memax = d3.max(lines, function(d) {
          return d.mymax;
        });

        var memin = d3.min(lines, function(d) {
          return d.mymin;
        });

        //x domain calculations	: zero to intelligent max choice, or intelligent min and max choice,  or interval chosen manually
        if (dvc.essential.xAxisScale == "auto_zero_max") {
          var xDomain = [0, Math.ceil(d3.max(lines, function(d) {
            return d.mymax;
          }))];
        } else if (dvc.essential.xAxisScale == "auto_min_max") {
          var xDomain = [Math.floor(d3.min(lines, function(d) {
              return d.mymin;
            })),
            Math.ceil(d3.max(lines, function(d) {
              return d.mymax;
            }))
          ];
        } else {
          var xDomain = dvc.essential.xAxisScale;
          var yDomain = dvc.essential.yAxisScale;
        }

        x.domain(xDomain);


        //create svg for chart
        var svg = d3.select('#graphic').selectAll('svg').data([lines]);

        svgEnter = svg.enter()
                    .append('svg')
                    .attr("width", chart_width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom + 30)


        svgEnter.attr("id", "chart")
          .style("background-color", "#fff")
          .attr("width", chart_width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom + 80)

        d3.select("#chart")
          .attr("height", height + margin.top + margin.bottom + 80)


        chartEnter = svgEnter.append("g").attr("id", "chartArea")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

        chartEnter.append("rect")
          .attr("class", "svgRect")
          .style("fill", "#fff")
          .attr("width", chart_width)
          .attr("height", height);

        chartEnter.append('g')
          .attr('class', 'x axis')
          .attr("transform", "translate(0, " + height + ")")
          .call(xAxis.tickSize(-height, 0).tickPadding(15))
          .selectAll("line")
          .style("stroke", "#E5E6E7");


        chartEnter.select(".x.axis")
          .append("text")
          .attr("y", 35)
          .attr("x", chart_width)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text(dvc.essential.xAxisLabel);

        //create y axis
        chartEnter.append('g')
          .attr('class', 'y axis')
          .call(yAxis)
          .selectAll(".tick text")
          .style("padding-right", "8px")


        d3.select('.y.axis')
              .call(yAxis)
              .selectAll(".tick text")
              .style("padding-right", "8px")
              .attr("y", "3")
              .attr("dy", "0")
              .attr("x","-9")
              .call(wrap, margin.left-18);


        d3.select('.x.axis')
       		  	.transition()
  		       	.duration(500)
              .attr("transform", "translate(0, " + height + ")")
              .call(xAxis.tickSize(-height, 0).tickPadding(15))

        d3.select(".y.axis").selectAll("line").remove();

        chartEnter.append("text")
          .attr('class', 'unit')
          .attr('transform', "translate(" + -margin.left + "," + eval(-margin.top) + ")") // + (lineNo+1)*20 or -10
          .attr("font-size", "12px")
          .attr("fill", "#666")
          .style("padding-top", "5px")
          .text(dvc.essential.yAxisLabel)


        lines1 = d3.select("#chartArea").selectAll('.tiefighter')
                .data(lines, function(d) { return d.subcat; });

        lines1.attr('y1', function(d, i) {
            return y(d.subcat);
          })
          .attr('y2', function(d) {
            return y(d.subcat);
          })
          .attr('x1', function(d, i) {
            return x(dvc.essential.xAxisScale[0]);
          }) //d.mymin
          .attr('x2', function(d) {
            return x(dvc.essential.xAxisScale[1]);
          });

        lines1.enter()
          .append('line')
          .attr('class', 'tiefighter')
          .attr("stroke", "#666")
          .attr("stroke-width", "1px")
          .attr('y1', function(d, i) {
            return y(d.subcat);
          })
          .attr('y2', function(d) {
            return y(d.subcat);
          })
          .attr('x1', function(d, i) {
            return x(dvc.essential.xAxisScale[0]);
          }) //d.mymin
          .attr('x2', function(d) {
            return x(dvc.essential.xAxisScale[1]);
          });

        lines1.exit().remove();


        // this code looks to draw arrows on the lines if specified in the
        if (dvc.essential.arrows == "start") {
          d3.select("g.line").selectAll("line")
            .attr("marker-start", "url(#triangleStart)")
        } else if (dvc.essential.arrows == "end") {
          d3.select("g.line").selectAll("line")
            .attr("marker-end", "url(#triangleEnd)")
        } else if (dvc.essential.arrows == "both") {
          d3.select("g.line").selectAll("line")
            .attr("marker-end", "url(#triangleEnd)")
            .attr("marker-start", "url(#triangleStart)")
        } else if (dvc.essential.arrows == "lowtohigh") {
          d3.selectAll('.line')
            .data(lines)
            .attr("marker-end", function(d) {
              if (d.mymin < d.mymax) {
                return "url(#triangleEnd)"
              } else {
                return "url(#triangleStart)"
              }
            })
        } else if (dvc.essential.arrows == "hightolow") {
          d3.selectAll('.line')
            .data(lines)
            .attr("marker-end", function(d) {
              if (d.mymin > d.mymax) {
                return "url(#triangleEnd)"
              } else {
                return "url(#triangleStart)"
              }
            })
        }

          circle = d3.select("#chartArea").selectAll('.circlemed')
          .data(lines, function(d) { return d.subcat; });

          circle.transition()
              .duration(750)
              .attr('cy', function(d) {
                return y(d.subcat);
              })
              .attr('r', ball * 1.5)
              .attr("data-nm", function(d, i) {
                return d[gender];
              })
              .attr('cx', function(d, i) {
                return x(d[gender]);
              });


          circle.enter()
            .append('circle')
            .attr("class", "circles circlemed")
            .classed("circleactive",true)
            .attr("fill", "#fff")
            .attr("stroke", dvc.essential.colour_palette[1])
            .attr("stroke-width", "3px")
            .attr("data-nm", function(d, i) {
              return d[gender];
            })
            .attr('cx', 0)
            .attr('cy', function(d) {
              return y(d.subcat);
            })
            .attr('r', ball * 1.5)
            .on("mouseover", function(d){
              d3.select(this).classed("circleactive2", true);
              vall = d[gender];
              showTooltip2(d,this,vall);
            })
            .on("mouseout", function(d){
              d3.select(this).classed("circleactive2", false);
              hideTooltip2(d);
            })
            .transition()
            .duration(750)
            .attr('cx', function(d, i) {
              return x(d[gender]);
            });


          circle.exit().remove();



        d3.selectAll("path").attr("fill", "none");

        d3.selectAll("text").attr("font-family", "'Open Sans', sans-serif");

        d3.selectAll(".x text").attr("font-size", "14px").attr("fill", "#323132");
        d3.selectAll(".y text").attr("font-size", "14px").attr("fill", "#323132");

        d3.selectAll(".y line")
          .attr("stroke", "#CCC")
          .attr("stroke-width", "1px")
          .style("shape-rendering", "crispEdges");

		setTimeout(function(){
        //use pym to calculate chart dimensions
			if (pymChild) {
			  pymChild.sendHeight();
			}
		},750);

      } //end tieFight

      function highlight(classnamed) {
          d3.selectAll(".rect").attr("stroke","#ccc").attr("r", ball);
          if(classnamed == "circlemed") {
            gender = "mymedian"
            update_graphic(curr_id);
          } else if (classnamed == "circlemin") {
            gender = "mymin"
            update_graphic(curr_id);
          } else if (classnamed == "circlemax") {
            gender = "mymax"
            update_graphic(curr_id);
          }

      }


      // function createLegend() {
      //
      //   var prevX = 0;
      //   var prevY = 0;
      //   lineNo = 0;
      //   var lineNoOld = 0;
      //
      //   dvc.essential.legendLabels.forEach(function(d, i) {
      //
      //     // draw legend text based on content of var legendLabels ...
      //     var_group = d3.select("#legend").attr("transform","translate(" + margin.left + ",0)").append("g")
      //
      //     var_group.append("circle")
      //       .attr("class", "rect rect" + i)
      //       .attr("fill", "#fff")
      //       .attr("stroke", dvc.essential.colour_palette[i])
      //       .attr("stroke-width", "3px")
      //       .attr("cx", 10)
      //       .attr("cy", 15)
      //       .attr("r",function() {
      //         if(i == 0) {return ball*1.5} else {return ball}
      //       })
      //       .on("click",function(d) {
      //         if(i == 0) {
      //           highlight("circlemed")
      //         } else if (i == 1) {
      //           highlight("circlemin")
      //         } else if (i == 2) {
      //           highlight("circlemax")
      //         }
      //       });
      //
      //
      //     var_group.append("text")
      //       .text(dvc.essential.legendLabels[i])
      //       .attr("class", "legend legend" + i)
      //       .attr("text-anchor", "start")
      //       .style("font-size", "12px")
      //       .style("fill", "#666")
      //       .attr('y', 15)
      //       .attr('x', 0)
      //       .on("click",function(d) {
      //         if(i == 0) {
      //           highlight("circlemed")
      //         } else if (i == 1) {
      //           highlight("circlemin")
      //         } else if (i == 2) {
      //           highlight("circlemax")
      //         }
      //       });
      //
      //
      //     d3.selectAll(".legend" + (i))
      //       .each(calcPosition);
      //
      //     function calcPosition() {
      //
      //
      //       var BBox = this.getBBox()
      //
      //
      //       //prevY =BBox.width
      //       d3.select(".legend" + (i))
      //         .attr("y", function(d) {
      //           if ((prevX + BBox.width + 50) > parseInt(graphic.style("width"))) {
      //             lineNoOld = lineNo;
      //             lineNo = lineNo + 1;
      //             prevX = 0;
      //           }
      //           return eval((lineNo * 20) + 20);
      //         })
      //         .attr("x", function(d) {
      //           return prevX + 25;
      //         })
      //
      //
      //       d3.select(".rect" + (i))
      //         .attr("y", function(d) {
      //
      //           if ((prevX + BBox.width + 50) > parseInt(graphic.style("width"))) {
      //             lineNoOld = lineNo;
      //             lineNo = lineNo + 1;
      //             prevX = 0;
      //           }
      //
      //           if (dvc.essential.legendStyle == "rect") {
      //             return eval((lineNo * 20) + 5);
      //           } else {
      //             return eval((lineNo * 20) + 12);
      //
      //           }
      //         })
      //         .attr("cx", function(d) {
      //           return prevX + 13;
      //         })
      //
      //       prevX = prevX + BBox.width + 50
      //
      //
      //
      //     }; // end function calcPosition()
      //   }); // end foreach
      // } // end function createLegend()

      function drawGraphic() {
        threshold_md = 788;
        threshold_sm = dvc.optional.mobileBreakpoint; // 510

        //set focus on first button when loading
      //  document.getElementById("YMH_2to4").focus();

        d3.select("#YMH_2to4").classed("btnselect",true);

        //set variables for chart dimensions dependent on width of #graphic
        if (parseInt(graphic.style("width")) < threshold_sm) {
          ball = 4;
          margin = {
            top: dvc.optional.margin_sm[0],
            right: dvc.optional.margin_sm[1],
            bottom: dvc.optional.margin_sm[2],
            left: dvc.optional.margin_sm[3]
          };
          chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
          height = rowheight + margin.top + margin.bottom;
        } else if (parseInt(graphic.style("width")) < threshold_md) {
          ball = 4;
          margin = {
            top: dvc.optional.margin_md[0],
            right: dvc.optional.margin_md[1],
            bottom: dvc.optional.margin_md[2],
            left: dvc.optional.margin_md[3]
          };
          chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
          height = rowheight + margin.top + margin.bottom;
        } else {
          ball = 5;
          margin = {
            top: dvc.optional.margin_lg[0],
            right: dvc.optional.margin_lg[1],
            bottom: dvc.optional.margin_lg[2],
            left: dvc.optional.margin_lg[3]
          }
          chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
          height = rowheight + margin.top + margin.bottom;
        }

        //change data on age group
        d3.selectAll(".btn--secondary")
          .on("click", function(d) {

          d3.selectAll(".btn--secondary").classed("btnselect",false);
          d3.select(this).classed("btnselect",true);



          curr_age = d3.select(this).attr("id")
          d3.csv("data/" + curr_age + ".csv", function(error, data) {
            graphic_data1 = data;
            update_graphic(curr_id);

          //  drawImages();


          })
        })
        .on("keypress", function(d) {
          if(d3.event.keyCode === 32 || d3.event.keyCode ===13) {
            d3.selectAll(".btn--secondary").classed("btnselect",false);
            d3.select(this).classed("btnselect",true);



            curr_age = d3.select(this).attr("id")
            d3.csv("data/" + curr_age + ".csv", function(error, data) {
              graphic_data1 = data;
              update_graphic(curr_id);
          })
        }})





        graphic_data = graphic_data1.filter(function(d) {
          return d.category == "average"
        })
        // clear out existing graphics


        tieFight();

        //create centre line if required
        if (dvc.optional.centre_line == true) {
          svg.append("line")
            .attr("id", "centreline")
            .attr('y1', 0)
            .attr('y2', height)
            .attr('x1', x(dvc.optional.centre_line_value))
            .attr('x2', x(dvc.optional.centre_line_value));

        } else {}

        // css fix


        //create link to source
        // d3.select(".footer").append("p")
        //   .text("Source: ")
        //   .append("a")
        //   .attr("href", dvc.essential.sourceURL)
        //   .attr("target", "_blank")
        //   .html(dvc.essential.sourceText);

        //use pym to calculate chart dimensions
        if (pymChild) {
          pymChild.sendHeight();
        }
      }


      //check whether browser can cope with svg
      if (Modernizr.svg) {
        //load config
        d3.json("config.json", function(error, config) {
          dvc = config;

          //load chart data
          d3.csv(dvc.essential.graphic_data_url, function(error, data) {
            graphic_data1 = data;

            //use pym to create iframed chart dependent on specified variables
            pymChild = new pym.Child({
              renderCallback: drawGraphic
            });
          });

        })

      } else {
        //use pym to create iframe containing fallback image (which is set as default)
        pymChild = new pym.Child();
        if (pymChild) {
          pymChild.sendHeight();
        }
      }
    </script>
</body>

</html>
