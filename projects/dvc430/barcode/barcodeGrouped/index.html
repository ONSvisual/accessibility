<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans+Condensed:wght@300&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <title>Local Area Migration Indicators</title>

    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <link rel="stylesheet" href="../lib/globalStyle.css" />
    <link rel="stylesheet" href="css/chosen.css" />
    <style type="text/css">

	body {
		display:block;
		overflow:auto;
		margin-bottom:60px;
		padding-bottom:60px;
	}
	.picaarticle {
	   font-size:14px;
	}

    #pcGo:hover {
        cursor:pointer;
        cursor:hand;
    }
	sup{
		vertical-align:super;
	}

    .inputOption{
		height:25px;
		margin-top:20px;
		padding-left:10px;
		background-color:white!important;
	}

	input:-webkit-autofill, textarea:-webkit-autofill, select:-webkit-autofill {
		-webkit-box-shadow: 0 0 0px 1000px white inset;
	}

	.useLocation {
		cursor:pointer;
		cursor:hand;
		background-color:#274796!important;
	}

	/*Bootstrap grid */
	.row {
	/*  margin-left: -15px;*/
	height:98px;
	clear: both;
	/*  margin-right: -15px;*/
	}
	.col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-4, .col-md-4, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-8, .col-md-8, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 {
	  position: relative;
	  min-height: 1px;
	  /*padding-left: 15px;*/
	  /*padding-right: 15px;*/
	}
	.col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 {
	  float: left;
	}
	.col-xs-12 {
	  width: 100%;
	}
	.col-xs-11 {
	  width: 91.66666667%;
	}
	.col-xs-10 {
	  width: 83.33333333%;
	}
	.col-xs-9 {
	  width: 75%;
	}
	.col-xs-8 {
	  width: 66.66666667%;
	}
	.col-xs-7 {
	  width: 58.33333333%;
	}
	.col-xs-6 {
	  width: 50%;
	}
	.col-xs-5 {
	  width: 41.66666667%;
	}
	.col-xs-4 {
	  width: 33.33333333%;
	}
	.col-xs-3 {
	  width: 25%;
	}
	.col-xs-2 {
	  width: 16.66666667%;
	}
	.col-xs-1 {
	  width: 8.33333333%;
	}
	.col-xs-pull-12 {
	  right: 100%;
	}
	.col-xs-pull-11 {
	  right: 91.66666667%;
	}
	.col-xs-pull-10 {
	  right: 83.33333333%;
	}
	.col-xs-pull-9 {
	  right: 75%;
	}
	.col-xs-pull-8 {
	  right: 66.66666667%;
	}
	.col-xs-pull-7 {
	  right: 58.33333333%;
	}
	.col-xs-pull-6 {
	  right: 50%;
	}
	.col-xs-pull-5 {
	  right: 41.66666667%;
	}
	.col-xs-pull-4 {
	  right: 33.33333333%;
	}
	.col-xs-pull-3 {
	  right: 25%;
	}
	.col-xs-pull-2 {
	  right: 16.66666667%;
	}
	.col-xs-pull-1 {
	  right: 8.33333333%;
	}
	.col-xs-pull-0 {
	  right: auto;
	}
	.col-xs-push-12 {
	  left: 100%;
	}
	.col-xs-push-11 {
	  left: 91.66666667%;
	}
	.col-xs-push-10 {
	  left: 83.33333333%;
	}
	.col-xs-push-9 {
	  left: 75%;
	}
	.col-xs-push-8 {
	  left: 66.66666667%;
	}
	.col-xs-push-7 {
	  left: 58.33333333%;
	}
	.col-xs-push-6 {
	  left: 50%;
	}
	.col-xs-push-5 {
	  left: 41.66666667%;
	}
	.col-xs-push-4 {
	  left: 33.33333333%;
	}
	.col-xs-push-3 {
	  left: 25%;
	}
	.col-xs-push-2 {
	  left: 16.66666667%;
	}
	.col-xs-push-1 {
	  left: 8.33333333%;
	}
	.col-xs-push-0 {
	  left: auto;
	}
	.col-xs-offset-12 {
	  margin-left: 100%;
	}
	.col-xs-offset-11 {
	  margin-left: 91.66666667%;
	}
	.col-xs-offset-10 {
	  margin-left: 83.33333333%;
	}
	.col-xs-offset-9 {
	  margin-left: 75%;
	}
	.col-xs-offset-8 {
	  margin-left: 66.66666667%;
	}
	.col-xs-offset-7 {
	  margin-left: 58.33333333%;
	}
	.col-xs-offset-6 {
	  margin-left: 50%;
	}
	.col-xs-offset-5 {
	  margin-left: 41.66666667%;
	}
	.col-xs-offset-4 {
	  margin-left: 33.33333333%;
	}
	.col-xs-offset-3 {
	  margin-left: 25%;
	}
	.col-xs-offset-2 {
	  margin-left: 16.66666667%;
	}
	.col-xs-offset-1 {
	  margin-left: 8.33333333%;
	}
	.col-xs-offset-0 {
	  margin-left: 0%;
	}
	@media (min-width: 699px) {
	  .col-sm-1, .col-sm-2, .col-sm-4, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-8, .col-sm-10, .col-sm-11, .col-sm-12 {
		float: left;
	  }
	  .col-sm-12 {
		width: 100%;
	  }
	  .col-sm-11 {
		width: 91.66666667%;
	  }
	  .col-sm-10 {
		width: 83.33333333%;
	  }
	  .col-sm-8 {
		width: 75%;
	  }
	  .col-sm-8 {
		width: 66.66666667%;
	  }
	  .col-sm-7 {
		width: 58.33333333%;
	  }
	  .col-sm-6 {
		width: 50%;
	  }
	  .col-sm-5 {
		width: 41.66666667%;
	  }
	  .col-sm-4 {
		width: 33.33333333%;
	  }
	  .col-sm-3 {
		width: 25%;
	  }
	  .col-sm-2 {
		width: 16.66666667%;
	  }
	  .col-sm-1 {
		width: 8.33333333%;
	  }
	  .col-sm-pull-12 {
		right: 100%;
	  }
	  .col-sm-pull-11 {
		right: 91.66666667%;
	  }
	  .col-sm-pull-10 {
		right: 83.33333333%;
	  }
	  .col-sm-pull-9 {
		right: 75%;
	  }
	  .col-sm-pull-8 {
		right: 66.66666667%;
	  }
	  .col-sm-pull-7 {
		right: 58.33333333%;
	  }
	  .col-sm-pull-6 {
		right: 50%;
	  }
	  .col-sm-pull-5 {

		right: 41.66666667%;
	  }
	  .col-sm-pull-4 {
		right: 33.33333333%;
	  }
	  .col-sm-pull-3 {
		right: 25%;
	  }
	  .col-sm-pull-2 {
		right: 16.66666667%;
	  }
	  .col-sm-pull-1 {
		right: 8.33333333%;
	  }
	  .col-sm-pull-0 {
		right: auto;
	  }
	  .col-sm-push-12 {
		left: 100%;
	  }
	  .col-sm-push-11 {
		left: 91.66666667%;
	  }
	  .col-sm-push-10 {
		left: 83.33333333%;
	  }
	  .col-sm-push-9 {
		left: 75%;
	  }
	  .col-sm-push-8 {
		left: 66.66666667%;
	  }
	  .col-sm-push-7 {
		left: 58.33333333%;
	  }
	  .col-sm-push-6 {
		left: 50%;
	  }
	  .col-sm-push-5 {
		left: 41.66666667%;
	  }
	  .col-sm-push-4 {
		left: 33.33333333%;
	  }
	  .col-sm-push-3 {
		left: 25%;
	  }
	  .col-sm-push-2 {
		left: 16.66666667%;
	  }
	  .col-sm-push-1 {
		left: 8.33333333%;
	  }
	  .col-sm-push-0 {
		left: auto;
	  }
	  .col-sm-offset-12 {
		margin-left: 100%;
	  }
	  .col-sm-offset-11 {
		margin-left: 91.66666667%;
	  }
	  .col-sm-offset-10 {
		margin-left: 83.33333333%;
	  }
	  .col-sm-offset-9 {
		margin-left: 75%;
	  }
	  .col-sm-offset-8 {
		margin-left: 66.66666667%;
	  }
	  .col-sm-offset-7 {
		margin-left: 58.33333333%;
	  }
	  .col-sm-offset-6 {
		margin-left: 50%;
	  }
	  .col-sm-offset-5 {
		margin-left: 41.66666667%;
	  }
	  .col-sm-offset-4 {
		margin-left: 33.33333333%;
	  }
	  .col-sm-offset-3 {
		margin-left: 25%;
	  }
	  .col-sm-offset-2 {
		margin-left: 16.66666667%;
	  }
	  .col-sm-offset-1 {
		margin-left: 8.33333333%;
	  }
	  .col-sm-offset-0 {
		margin-left: 0%;
	  }
	}

	@media (min-width: 699px) {
		.graphicslabel{
			color:#666666;
			font-size:14px;
			margin-bottom:10px;
			margin-top:0px;
			font-weight:normal;
			text-align:right;
			padding-right:0px;
			padding-top:15px;
		}

		.graphics{
			box-sizing:border-box;
			-moz-box-sizing:border-box;
			-webkit-box-sizing:border-box;
			border-left-style:solid;
			/*border-left-width:1px; */
			border-left-color:#dadada;
		}
	}
		@media (max-width: 699px) {
		.graphicslabel{
			color:grey;
			font-size:14px;
			margin-bottom:10px;
			margin-top:0px;
			font-weight:normal;
			text-align:left;
			padding-right:0px;
			padding-top:15px;
		}

		.graphics{

		}
	}

	.hoverbar{
		cursor:pointer;
		cursor:hand;
	}
	.hoverbar:hover{
		cursor:pointer;
		cursor:hand;
		opacity:1;
		width:2px;
		transform:translate(0,2)
	}

	.container {
		overflow:hidden;
	}
	.hovertrick{
		cursor:pointer;
		cursor:hand;
		width:2px;
		opacity:1;
		fill:#008cba;
		transform:translate(-1,0);
	}

	.visuallyhidden {
		position: absolute;
		width: 1px;
		height: 1px;
		margin: -1px;
		padding:0;
		overflow: hidden;
		clip: rect(0,0,0,0); border: 0;
		display:block !important;
	}



    </style>
</head>
<body>
    <div id="occupation"></div>
    <div>
    	<p style="font-size:14px;">Your selected area is labelled <span style="color:#0075A3; font-weight:bold;">BLUE</span> and the area labelled <span style="font-weight:bold; color:#D2376D;">PINK</span> is the UK average</p>
    </div>


    <div id="KeyContainer" style="margin-bottom:20px;"></div>

    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
                <p class="graphicslabel">Long-term international net<sup>2</sup> migration per 1,000 resident population, mid-2016</p>
            	<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_1"></span></li>
            		<li><span>UK</span>: <span id="UKValue_1"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic"></div>
        </div>



        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
                <p class="graphicslabel">Short-term international migration<sup>3</sup> inflow estimate, mid-2015 (persons per 1,000 resident population)</p>
            	<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_2"></span></li>
            		<li><span>UK</span>: <span id="UKValue_2"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic2"></div>
        </div>



        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
            	<p class="graphicslabel">New migrant GP<sup>4</sup> registrations, mid-2016 (persons per 1,000 resident population)</p>
        		<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_3"></span></li>
            		<li><span>UK</span>: <span id="UKValue_3"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic3"></div>
        </div>



        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
            	<p class="graphicslabel">NINo registrations to non-UK nationals, mid-2016 (persons per 1,000 resident population)</p>
        		<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_4"></span></li>
            		<li><span>UK</span>: <span id="UKValue_4"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic4"></div>
        </div>



        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
                <p class="graphicslabel">Non-British estimate, 2016 (%)</p>
            	<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_5"></span></li>
            		<li><span>UK</span>: <span id="UKValue_5"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic5"></div>
        </div>



        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
                <p class="graphicslabel">Non-UK born estimate, 2016 (%)</p>
            	<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_6"></span></li>
            		<li><span>UK</span>: <span id="UKValue_6"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic6"></div>
        </div>



        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-4">
                <p class="graphicslabel">Live births to non-UK born mothers, 2016 (%)</p>
            	<ul class="visuallyhidden">
            		<li><span class="selectedAreaSR"></span>: <span id="selectedAreaValue_7"></span></li>
            		<li><span>UK</span>: <span id="UKValue_7"></span></li>
            	</ul>
            </div>

            <div class="graphics col-xs-12 col-sm-8 col-md-8" id="graphic7"></div>
        </div>
    </div>

    <script src="https://cdn.ons.gov.uk/vendor/d3/3.5.17/d3.min.js" type="text/javascript"></script>
    <script src="https://cdn.ons.gov.uk/vendor/jquery/1.12.4/jquery.min.js"></script>
    <script src="../lib/modernizr.svg.min.js" type="text/javascript"></script>
    <script src="https://cdn.ons.gov.uk/vendor/pym/0.4.2/pym.min.js" type="text/javascript"></script>
    <script src="https://cdn.ons.gov.uk/vendor/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="../lib/saveSvgAsPng.js" type="text/javascript"></script>
    <script src="js/chosen.jquery.js"></script>


    <script>
    //╭━━╮╱╱╱╱╱╱╱╱╭╮
	//╰┫┣╯╱╱╱╱╱╱╱╭╯╰╮
	//╱┃┃╭━╮╭━━┳╮┣╮╭╋━━╮
	//╱┃┃┃╭╮┫╭╮┃┃┃┃┃┃━━┫
	//╭┫┣┫┃┃┃╰╯┃╰╯┃╰╋━━┃
	//╰━━┻╯╰┫╭━┻━━┻━┻━━╯
	//╱╱╱╱╱╱┃┃
	//╱╱╱╱╱╱╰╯

		var graphic = d3.select('#graphic');
		var graphic2 = d3.select('#graphic2');
		var graphic3 = d3.select('#graphic3');
		var graphic4 = d3.select('#graphic4');
		var graphic5 = d3.select('#graphic5');
		var graphic6 = d3.select('#graphic6');
		var graphic7 = d3.select('#graphic7');
		var keypoints = d3.select('#keypoints');
		var footer = d3.select(".footer");
		var pymChild = null;
		var LAname = "Westminster";
		var AreaLoad = "Westminster";
		var filtereddata = "X";
		var filtereddataEngland = "X";
		var graphic_data = "X";
		var AreaLoad4 = "Westminster";
		var width = null;
		var substringUpdateTo = null;
		var dontsweep = false;
		var selectarea2 = null;
		var solidSelected = "Westminster";
		var numberFormat1 = d3.format(",.0f");
		var numberFormat2 = d3.format(",.1f");


		//old axis scales for config min-max
		//"xAxisScale":[[9.5,26.8],[44.8,69.8],[36.5,62.8],[379.4,1223.2],[54,71.1],[52.4,71.1]],


		function occopt () {

			//Create a chosen drop down to show the list of occupations

			dvc.allOcc = [];

			//Create an array for each occupation title
			graphic_data.forEach(function(d,i){
					dvc.allOcc.push(graphic_data[i].name);
			});

			dvc.allCode = [];

			//Create an array for each occupation code
			graphic_data.forEach(function(d,i){
					dvc.allCode.push(graphic_data[i].name2);
			});

			// Join occupation and codes together in an array
			var codeoccyzip = d3.zip(dvc.allOcc, dvc.allCode);


			//sort occupation list alphabetically
			dvc.codeoccyzip = codeoccyzip.sort(function(b, a){ return d3.descending(a[0], b[0])});


			// Build option menu for occupations
			var optns = d3.select("#occupation").append("div").attr("id","sel").append("select")
					.attr("id","occselect")
					.attr("style","width:75%")
					.style("margin-bottom","20px")
					.attr("class","chosen-select");

			//append message

			optns.append("option")
				.attr("value","first")
				.text("");

			optns.selectAll("p").data(dvc.codeoccyzip).enter().append("option")
				.attr("value", function(d){ return d[1]})
				.text(function(d){ return d[0]});


			// Little function to bring objects to the front
			d3.selection.prototype.moveToFront = function() {
			  return this.each(function() {
				this.parentNode.appendChild(this)
			  });
			};


			$('#occselect').chosen({width: "75%", allow_single_deselect: true, placeholder_text_single:"Choose your area"}).on('change',function(evt,params){

				if(typeof params != 'undefined') {

					AreaLoad = params.selected;

					solidSelected = params.selected;

					AreaLoad2 = AreaLoad.replace(/\s/g,'');
					AreaLoad3 = AreaLoad2.replace(',','');
					AreaLoad4 = AreaLoad3.replace('-','');
					AreaLoad4 = AreaLoad4.replace('-','');

					filtereddata = graphic_data.filter(function(d) {return d.name2 == AreaLoad;});

					filtereddataEngland = graphic_data.filter(function(d) {return d.name2 == "England";});

					drawGraphic();

				}
			});
		} //End of make occupation

		function drawGraphic(width) {
			for (j = 0; j <= dvc.essential.VariableLoad.length-1; j++) {

				//j = 6;
			   	var threshold_md = 788;
			   	var threshold_sm = dvc.optional.mobileBreakpoint;

			   	//change LA name at the top
			   	legendArea = filtereddata[0].name;
			   	d3.select("#laName").html(legendArea);


			  	//set variables for chart dimensions dependent on width of #graphic
			    if (parseInt(graphic.style("width")) < threshold_sm) {
			            var margin = {top: dvc.optional.margin_sm[0], right: dvc.optional.margin_sm[1], bottom: dvc.optional.margin_sm[2], left: dvc.optional.margin_sm[3]};
						var chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
			            var height = dvc.essential.barHeight_sm_md_lg[0] +0 - margin.top - margin.bottom;
			    } else if (parseInt(graphic.style("width")) < threshold_md){
			        	var margin = {top: dvc.optional.margin_md[0], right: dvc.optional.margin_md[1], bottom: dvc.optional.margin_md[2], left: dvc.optional.margin_md[3]};
						var chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
			            var height = dvc.essential.barHeight_sm_md_lg[0] +0 - margin.top - margin.bottom;
			  	} else {
			        	var margin = {top: dvc.optional.margin_lg[0], right: dvc.optional.margin_lg[1], bottom: dvc.optional.margin_lg[2], left: dvc.optional.margin_lg[3]}
						var chart_width = parseInt(graphic.style("width")) - margin.left - margin.right;
			            var height = dvc.essential.barHeight_sm_md_lg[0] +0 - margin.top - margin.bottom;
				}


			    // clear out existing graphics
				keypoints.selectAll("*").remove();
				footer.selectAll("*").remove();
				d3.select("#chart" + [j]).remove();

				var x = d3.scale.linear()
			        .range([ 0, chart_width]);

				var y = d3.scale.ordinal()
					.rangeRoundBands([0, height], .1)

			    y.domain(graphic_data.map(function(d) { return d.name; }));

			    var yAxis = d3.svg.axis()
			        .scale(y)
			        .orient("left")

			    var xAxis = d3.svg.axis()
			        .scale(x)
			        .orient('bottom')
					.tickSize(5, 0, 0);

				//specify number or ticks on x axis
				if (parseInt(graphic.style("width")) <= threshold_sm) {
					xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[0])
				} else if (parseInt(graphic.style("width")) <= threshold_md){
					xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[1])
				} else {
					xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[2])
				}


			    var bar = d3.svg.line()
			        .y(function(d) { return y(d.name); })
			        .x(function(d) { return x(d.amt); });

			    // parse data into columns
			    var bars = {};
			    for (var column in graphic_data[0]) {
			        if (column == 'name') continue;
			        bars[column] = graphic_data.map(function(d) {
			            return {
			                'name': d.name,
			                'amt': d[column]
			            };
			        });
			    }

			  	//y domain calculations	: zero to intelligent max choice, or intelligent min and max choice,  or interval chosen manually

				var xDomain = dvc.essential.xAxisScale[j];

			    x.domain(xDomain);


				d3.select("#buttonid").on("click",function(){saveSvgAsPng(document.getElementById("chart"), "diagram.png")});

				d3.select('#' + dvc.essential.DivSelector[j]).select('svg')
		            .append("g")
		            .attr("id", "source")
		            .append("text")
		            .attr("text-anchor", "start")
		            .style("font-size", "14px")
		            .style("fill", "#666")
		            .attr('y',height + margin.top + margin.bottom-10)
		            .attr('x',0)
		            .text("Source: ")
		            .append("a")
		            .style("fill", "#4774CC")
		            .attr("href", dvc.essential.sourceURL)
		            .attr("target", "_blank")
		            .text(dvc.essential.sourceText);


			    //create svg for chart
			    var svg = d3.select('#' + dvc.essential.DivSelector[j]).append('svg')
					.attr("id",function(d){return "chart" + [j]})
					.style("background-color","#fff")
			        .attr("width", chart_width + margin.left + margin.right)
			        .attr("height", height + margin.top + margin.bottom +30)
			        .append("g")
			        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

				svg.append("rect")
					.attr("class","svgRect")
					.attr("width", chart_width)
					.attr("height", height)
					.attr("fill","transparent")

			    svg.append('g')
			        .attr('class', 'x axis')
			        .attr("transform", "translate(0, "+height+")")
			        .call(xAxis).append("text")
					.attr("y", 25)
					.attr("x",chart_width)
					.attr("dy", ".71em")
					.style("text-anchor", "start")
					.attr("font-size","14px")
					.attr("fill","#666")
					.text(dvc.essential.xAxisLabel);


				svg.append('g').attr("class","bars").selectAll('rect')
					.data(bars[[dvc.essential.VariableLoad[j]]])
					.enter()
					.append('rect')
					.attr("fill","grey")
					.attr("stroke-width",10)
					.attr("stroke","rgba(1,1,1,0)")
					.attr("class",function(d,i){return bars.name2[i].amt + " hoverbar allbars"})
					.attr("id",function(d,i){return bars.name2[i].amt})
					.attr("opacity","0.3")
					.attr("width","1")
					.attr("x", function(d,i){return x(d.amt);})
					.attr("y",0)
					.attr("height", 30);

				if (pymChild) {
					pymChild.sendHeight();
				}

				d3.selectAll(".England")
					.classed("hoverbar",false);

				d3.selectAll(".hoverbar").on("mouseover", function(d,i){
					selectarea = d3.select(this).attr("id");
					areaLoad = d3.select(this).attr("id");
					d3.selectAll("." + areaLoad).classed("hovertrick",true);
					$("#occselect").val(areaLoad);
					$("#occselect").trigger("chosen:updated");
				});

				d3.selectAll(".hoverbar").on("mouseout", function(d,i){
					d3.selectAll("." + areaLoad).classed("hovertrick",false);
					$("#occselect").val(solidSelected);
					$("#occselect").trigger("chosen:updated");
				});

				d3.selectAll(".hoverbar").on("click", function(d,i){
					selectarea = d3.select(this).attr("id");
					solidSelected = d3.select(this).attr("id");
					d3.selectAll(".allbars").classed("hoverbar",true);
					d3.select(this).classed("hoverbar",false);

					areaLoad = d3.select(this).attr("id");

					//selectarea2 = selectarea.substring(0, selectarea.length -1);


					$("#occselect").val(areaLoad);
					$("#occselect").trigger("chosen:updated").change();

					updateStuff();
				});

				dontsweep = false;


				//draw full annotations if width is more than 700px, else draw them in the Key div.

				var selAreaValue;

				svg.append('g').attr("class","selectedArea").selectAll('text')
					.data(filtereddata)
					.enter()
					.append("text")
					//the text attribute will nest if statements to;
					//A - Deal with situations where numbers require different rounding conventions (1dp or whole)
					//&
					//B - Deal with different grammer when referring to singular (eg people/person)
					.text(function(d,i) {
						if (dvc.essential.textFormat[j] == "round") {

							if(filtereddata[0][dvc.essential.VariableLoad[j]]<1.6 && filtereddata[0][dvc.essential.VariableLoad[j]] >0.5) {
								selAreaValue = numberFormat1(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelectorAlternative[j];
								return selAreaValue;
							} else {
								selAreaValue = numberFormat1(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j];
								return selAreaValue;
							}
						} else if (dvc.essential.textFormat[j] == "1dp") {

							if(filtereddata[0][dvc.essential.VariableLoad[j]]<=1) {
								selAreaValue = numberFormat2(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelectorAlternative[j];
								return selAreaValue;
							} else {
								selAreaValue = numberFormat2(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j];
								return selAreaValue;
							}
						}
					})
					//.text(function(d){return numberFormat1(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j]})
					.attr("x", function(d,i) {
						if (d[dvc.essential.VariableLoad[j]] >= dvc.essential.EnglandAverage[j]) {
							return x(d[dvc.essential.VariableLoad[j]]) - 8
						} else {
							return x(d[dvc.essential.VariableLoad[j]]) + 8
						}
					})
					.attr("text-anchor", function(d,i) {
						if (d[dvc.essential.VariableLoad[j]] >= dvc.essential.EnglandAverage[j]) {
							return "end"
						} else {
							return "start"
						}
					})
					.attr("y","-7")
					.attr("font-size","14px")
					.attr("fill","white")
					.attr("class","alltext")
					.attr("opacity","1")
					.transition().duration(500).attr("fill","#0075A3")
					.attr("id",function(d,i){return "SelectedAreaText" + j});

				// Screen reader only values
				d3.select("#selectedAreaValue_" + (j+1)).text(selAreaValue)

				legendArea = filtereddata[0].name;

				// Screen reader only values
				d3.selectAll(".selectedAreaSR").text(legendArea)

				d3.select("#KeyContainer").html(function(d){return "<p><span style='color:#0075A3; font-size:18px; font-weight: bold'>-" + legendArea + " </span><span style='color:#D2376D; font-size:18px; font-weight: bold'>-UK</span></p>"});

				var UKValue;

				svg.append('g').attr("class","selectedAreaEngland").selectAll('text')
					.data(filtereddataEngland)
					.enter()
					.append("text")
					.text(function(d,i) {
						if (dvc.essential.textFormat[j] == "round") {
							UKValue = numberFormat1(filtereddataEngland[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j];
							return UKValue;
						} else if (dvc.essential.textFormat[j] == "1dp") {
							UKValue = numberFormat2(filtereddataEngland[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j];
							return UKValue;
						}
					})

					.attr("x", function(d,i){return x(d[dvc.essential.VariableLoad[j]]) + 8})
					.attr("y","47")
					.attr("text-anchor","start")
					.attr("font-size","14px")
					.attr("fill","white")
					.attr("opacity","1")
					.transition().duration(500).attr("fill","#D2376D")
					.attr("id","SelectedAreaText");

				// Screen reader only values
				d3.select("#UKValue_" + (j+1)).text(UKValue)

				//Extend and shade selected bars

				d3.selectAll("." + AreaLoad4)
					.classed("hoverbar",false)
					.classed("bluebar",true)
					.transition()
					.duration(500)
					.attr("fill","#0075A3")
					.attr("opacity","1")
					.attr("height", 50)
					.attr("width","2")
					.attr("transform","translate(0,-20)");

				d3.selectAll(".England")
					.classed("hoverbar",false)
					.classed("greybar",true)
					.transition()
					.duration(500)
					.attr("fill","#D2376D")
					.attr("opacity","1")
					.attr("height", 50)
					.attr("width","2");


				if (pymChild) {
					pymChild.sendHeight();
				}


				function updateStuff(d,j){

					d3.selectAll(".bluebar")
						.attr("opacity","0.3")
						.attr("height",30)
						.attr("fill","grey")
						.attr("width","1")
						.attr("transform","translate(0,0)");

					d3.selectAll(".allbars")
						.classed("bluebar",false)
						.classed("greybar",false);

					filtereddata = graphic_data.filter(function(d) {return d.name2 == areaLoad;});

					legendArea = filtereddata[0].name;

					AreaLoad4 = areaLoad;

					d3.select("#KeyContainer").html(function(d){return "<p><span style='color:#0075A3; font-size:16px;'>-" + legendArea + " </span><span style='color:#D2376D; font-size:16px;'>-UK</span></p>"});

					d3.selectAll("#England")
						.classed("hoverbar",false);

					d3.selectAll("." + AreaLoad4)
						.classed("hoverbar",false)
						.classed("bluebar",true)
						.transition()
						.duration(500)
						.attr("fill","#0075A3")
						.attr("opacity","1")
						.attr("height", 50)
						.attr("width","2")
						.attr("transform","translate(0,-20)");

					for(j=0;j<dvc.essential.VariableLoad.length;j++) {

		    			x.domain(dvc.essential.xAxisScale[j]);

						d3.select("#SelectedAreaText" + j)
							.text(function(d,i) {
								if (dvc.essential.textFormat[j] == "round") {

									if(filtereddata[0][dvc.essential.VariableLoad[j]]<1.6 && filtereddata[0][dvc.essential.VariableLoad[j]] >0.5) {
										return numberFormat1(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelectorAlternative[j]
									} else {
										return numberFormat1(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j]
									}
								} else if (dvc.essential.textFormat[j] == "1dp") {

									if(filtereddata[0][dvc.essential.VariableLoad[j]]<=1) {
										return numberFormat2(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelectorAlternative[j]
									} else {
										return numberFormat2(filtereddata[0][dvc.essential.VariableLoad[j]]) + dvc.essential.UnitSelector[j]
									}
								}
							})
							.attr("x", function(d,i){
								if (filtereddata[0][dvc.essential.VariableLoad[j]] >= dvc.essential.EnglandAverage[j]) {
									return x(filtereddata[0][dvc.essential.VariableLoad[j]]) - 8
								} else {
									return x(filtereddata[0][dvc.essential.VariableLoad[j]]) + 8
								}
							})
							.attr("text-anchor", function(d,i) {
								if (filtereddata[0][dvc.essential.VariableLoad[j]] >= dvc.essential.EnglandAverage[j]) {
									return "end"
								} else {
									return "start"
								}
							})
							.attr("fill","white")
							.attr("class","alltext")
							.attr("opacity","1")
							.transition().duration(500).attr("fill","#0075A3");

						if (pymChild) {
							pymChild.sendHeight();
						}
					}

					if (pymChild) {
						pymChild.sendHeight();
					}
				};


				d3.selectAll("text").attr("font-family","'Open Sans', sans-serif");

				//use pym to calculate chart dimensions
			    if (pymChild) {
			        pymChild.sendHeight();
				}
			}
		}


		if (Modernizr.svg) {
		   //load config
			d3.json("config.json", function(error, config) {
			dvc=config

				//load chart data
				d3.csv( dvc.essential.graphic_data_url, function(error, data) {
					graphic_data = data;

					filtereddata = data.filter(function(d) {return d.name == AreaLoad;});
					filtereddataEngland = graphic_data.filter(function(d) {return d.name == "England";});

					// graphic_data.forEach(function(d) {
					// 	d.name = d3.time.format(dvc.essential.dateFormat).parse(d.name);

					// });

					names = d3.keys(/*data*/graphic_data[0]).filter(function(key) { return key !== "state"; });

					/*data*/graphic_data.forEach(function(d) {
					  d.ages = names.map(function(name) { return {name: name, value: +d[name]}; });
					});

						//use pym to create iframed chart dependent on specified variables
						pymChild = new pym.Child({ renderCallback: drawGraphic});
						occopt();
					});
			})

		} else {
			 //use pym to create iframe containing fallback image (which is set as default)
			 pymChild = new pym.Child();
			if (pymChild) {
				pymChild.sendHeight();
			}
		}


		var _gaq = _gaq || [];
		 _gaq.push(['_setAccount', 'UA-37894017-1']);
		 _gaq.push(['_trackPageview']);


		 (function() {

			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		 })();
    </script>
</body>
</html>
